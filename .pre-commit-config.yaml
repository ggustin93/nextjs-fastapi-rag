# Pre-commit hooks for code quality and consistency
# Install with: pip install pre-commit && pre-commit install

default_language_version:
  python: python3.11
  node: 18.17.0

repos:
  # ====================================
  # General Checks
  # ====================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        exclude: '\.md$'
      - id: end-of-file-fixer
      - id: check-yaml
        exclude: '^.github/workflows/'
      - id: check-added-large-files
        args: ['--maxkb=500']
      - id: check-case-conflict
      - id: check-merge-conflict
      - id: check-json
      - id: check-toml
      - id: check-docstring-first
      - id: debug-statements
      - id: detect-private-key
      - id: mixed-line-ending
        args: ['--fix=lf']
      - id: no-commit-to-branch
        args: ['--branch', 'main', '--branch', 'master']

  # ====================================
  # Python Code Quality
  # ====================================
  # Black - Code Formatter
  - repo: https://github.com/psf/black
    rev: 24.3.0
    hooks:
      - id: black
        language_version: python3.11
        args: ['--line-length=100']
        exclude: '^(\.venv|venv|services/api/venv)/'

  # Ruff - Fast Python Linter
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.3.5
    hooks:
      - id: ruff
        args: [
          '--fix',
          '--select=E,F,W,C90,I,N,UP,YTT,ANN,S,BLE,FBT,B,A,COM,C4,DTZ,T10,EM,EXE,ISC,ICN,G,INP,PIE,PYI,PT,Q,RSE,RET,SLF,SIM,TID,TCH,ARG,PTH,ERA,PD,PGH,PL,TRY,NPY,RUF',
          '--ignore=E501,ANN101,ANN102,S101,PLR0913,PLR2004',
          '--line-length=100',
        ]
        exclude: '^(\.venv|venv|services/api/venv)/'
      - id: ruff-format

  # MyPy - Type Checker
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.9.0
    hooks:
      - id: mypy
        additional_dependencies:
          - types-requests
          - types-PyYAML
          - pydantic
        args: [
          '--ignore-missing-imports',
          '--no-strict-optional',
          '--disable-error-code=import-untyped',
        ]
        exclude: '^(tests|\.venv|venv|services/api/venv)/'

  # Bandit - Security Linter
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.8
    hooks:
      - id: bandit
        args: ['-ll', '--skip=B101,B601,B602,B607']
        exclude: '^(tests|\.venv|venv|services/api/venv)/'

  # ====================================
  # JavaScript/TypeScript Quality
  # ====================================
  # ESLint
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v9.0.0
    hooks:
      - id: eslint
        files: '\.(js|jsx|ts|tsx)$'
        args: ['--fix', '--max-warnings=0']
        additional_dependencies:
          - eslint@8.57.0
          - eslint-config-next@14.0.0
          - '@typescript-eslint/parser@6.21.0'
          - '@typescript-eslint/eslint-plugin@6.21.0'
        exclude: '^(node_modules|\.next|out|build)/'

  # Prettier
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        files: '\.(js|jsx|ts|tsx|css|scss|md|json|yaml|yml)$'
        args: ['--write', '--single-quote', '--print-width=100']
        exclude: '^(node_modules|\.next|out|build|package-lock\.json)/'

  # ====================================
  # Documentation
  # ====================================
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.39.0
    hooks:
      - id: markdownlint
        args: ['--fix']
        exclude: '^(node_modules|\.next|CHANGELOG\.md)/'

  # ====================================
  # Secrets Detection
  # ====================================
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: '(\.env\.example|package-lock\.json|poetry\.lock|yarn\.lock)'

  # ====================================
  # Commit Message
  # ====================================
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v3.20.0
    hooks:
      - id: commitizen
        stages: [commit-msg]

# Local hooks
  - repo: local
    hooks:
      # Python import sorting
      - id: isort
        name: isort
        entry: isort
        language: system
        types: [python]
        args: ['--profile', 'black', '--line-length', '100']
        exclude: '^(\.venv|venv|services/api/venv)/'

      # Check requirements.txt is up to date
      - id: requirements-txt-fixer
        name: Fix requirements.txt
        entry: requirements-txt-fixer
        language: system
        files: requirements.*\.txt$

      # Prevent committing .env files
      - id: no-env-files
        name: Block .env files
        entry: '.env files should not be committed'
        language: fail
        files: '^\.env$|^\.env\..*(?<!\.example)$'

      # Check for console.log in frontend
      - id: no-console-log
        name: No console.log
        entry: 'console\.log'
        language: pygrep
        files: '\.(js|jsx|ts|tsx)$'
        exclude: '^(tests|__tests__|.*\.test\.|.*\.spec\.)'

# Configuration
fail_fast: false
exclude: |
  (?x)^(
    .*\.(pyc|pyo|egg-info|min\.js|min\.css)|
    __pycache__|
    \.git|
    \.venv|
    venv|
    node_modules|
    \.next|
    build|
    dist|
    \.DS_Store|
    .*\.svg|
    .*\.ico|
    .*\.png|
    .*\.jpg|
    .*\.jpeg|
    .*\.gif|
    .*\.woff|
    .*\.woff2|
    .*\.ttf|
    .*\.eot|
    package-lock\.json|
    poetry\.lock|
    yarn\.lock
  )